<div class="rw-container rw-trip-show">
  <h1 class="rw-trip-title">Your trip to “<%= @trip.city %>”</h1>

  <div class="rw-trip-grid">
    <!-- SUMMARY -->
    <section class="rw-card">
      <h3 class="rw-card-title">Summary</h3>

      <ul class="rw-list">
        <li><strong>From:</strong> <%= @trip.departure %></li>
        <li><strong>Dates:</strong> <%= @trip.start_date %> → <%= @trip.end_date %></li>
        <li><strong>People:</strong> <%= @trip.people %></li>
        <li><strong>Preferences:</strong> <%= @trip.preferences.pluck(:name).join(", ").presence || "—" %></li>
        <li><strong>Further preferences:</strong> <%= @trip.further_preferences.presence || "—" %></li>
      </ul>

      <div class="rw-card-actions">
<%= link_to "Adjust Data", edit_trip_path(@trip), class: "rw-btn rw-btn--secondary" %>
      </div>
    </section>

    <!-- TRANSPORTATION -->
    <section class="rw-card">
      <h3 class="rw-card-title">Transportation</h3>

      <% if @transport_options.any? %>
        <div class="rw-transport-list">
          <% @transport_options.each do |t| %>
            <div class="rw-transport-item">
              <div class="rw-transport-mode"><%= t.mode.to_s.upcase %></div>

              <div class="rw-muted">
                <%# Display duration in hours: e.g., 6h18 instead of 378 min %>
                <%= minutes_to_hours(t.duration_minutes) %> •
                €<%= t.price %> •
                <%= t.co2_kg %> kg CO₂
                <span class="rw-eco-rating"><%= eco_rating_leaves(t.co2_kg) %></span>
              </div>

              <div class="rw-muted"><%= t.summary %></div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="rw-muted">Transport options will appear here after generation.</p>
      <% end %>
    </section>
  </div>

  <h2 class="rw-section-title">Your itinerary in "<%= @trip.city %>"</h2>

  <% if @days.any? %>
    <div class="rw-days">
      <% @days.each do |day| %>
        <section class="rw-card">
          <div class="rw-day-header">
            <span>Day <%= day.day_number %></span>
            <span><%= day.date %></span>
          </div>

          <% if day.activities.any? %>
            <div class="rw-activities">
              <% day.activities.each do |a| %>
                <div class="rw-activity">
                  <div class="rw-activity-title">
                    <%= a.starts_at&.strftime("%H:%M") %> - <%= a.title %>
                  </div>
                  <div class="rw-muted"><%= a.location %></div>
                  <ul class="rw-list">
                    <li><%= a.details %></li>
                  </ul>
                </div>
              <% end %>
            </div>

            <% day_markers = day.activities.select { |a| a.latitude.present? && a.longitude.present? }.map { |a| { title: a.title, location: a.location, lat: a.latitude, lng: a.longitude } } %>
            <% if day_markers.any? %>
              <div class="rw-map rw-map--small"
                   data-controller="map"
                   data-map-token-value="<%= ENV['MAPBOX_ACCESS_TOKEN'] %>"
                   data-map-markers-value="<%= day_markers.to_json %>">
              </div>
            <% end %>
          <% else %>
            <p class="rw-muted rw-space-top">Activities will appear here.</p>
          <% end %>
        </section>
      <% end %>
    </div>
  <% else %>
    <section class="rw-card">
      <p class="rw-muted">Your itinerary will appear here after generation.</p>
    </section>
  <% end %>

  <div class="rw-page-actions">
    <%= button_to "Save",
              save_trip_path(@trip),
              method: :patch,
              class: "rw-btn rw-btn--primary",
              data: { turbo: false } %>
    <%= link_to "Export",
            export_trip_path(@trip),
            class: "rw-btn rw-btn--secondary",
            data: { turbo: false } %>
  </div>
</div>
